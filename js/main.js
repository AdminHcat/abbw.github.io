function getScrollHeight(t){var e=0,i=0;return t.body&&(e=t.body.scrollHeight),t.documentElement&&(i=t.documentElement.scrollHeight),0<e-i?e:i}function getWindowHeight(t){return"CSS1Compat"==t.compatMode?t.documentElement.clientHeight:t.body.clientHeight}!function(o,n){function c(){}function r(t){var e=t.offsetLeft,i=t.offsetTop;if(t.offsetParent){var o=arguments.callee(t.offsetParent);e+=o.x,i+=o.y}return{x:e,y:i}}function s(){return n.documentElement.scrollTop||n.body.scrollTop}var t,h=n.body,d=n.querySelector.bind(n),a=n.querySelectorAll.bind(n),l=d("html"),e=d("#gotop"),g=d("#gobottom"),f=d("#menu"),u=d("#header"),m=d("#mask"),v=d("#menu-toggle"),p=d("#menu-off"),L=d("#loading"),y=o.requestAnimationFrame,w=Array.prototype.forEach,E="ontouchstart"in o&&/Mobile|Android|iOS|iPhone|iPad|iPod|Windows Phone|KFAPWI/i.test(navigator.userAgent)?"touchstart":"click",x=/micromessenger/i.test(navigator.userAgent),S={goTop:function(t){var e=s(),i=2<arguments.length?arguments[1]:Math.abs(e-t)/12;e&&t<e?(o.scrollTo(0,Math.max(e-i,0)),y(arguments.callee.bind(this,t,i))):t&&e<t?(o.scrollTo(0,Math.min(e+i,t)),y(arguments.callee.bind(this,t,i))):this.toc.actived(t)},goBottom:function(t){var e=s(),i=2<arguments.length?arguments[1]:Math.abs(e-t)/12;e&&t<e?(o.scrollTo(0,Math.max(e-i,0)),y(arguments.callee.bind(this,t,i))):t&&e<t-1?(o.scrollTo(0,Math.min(e+i,t)),y(arguments.callee.bind(this,t,i))):this.toc.actived(t)},toggleGotop:function(t){t>o.innerHeight/2?e.classList.add("in"):e.classList.remove("in")},toggleGoBottom:function(t){t<getScrollHeight(n)-getWindowHeight(n)-o.innerHeight/2?g.classList.add("in"):g.classList.remove("in")},toggleMenu:function(t){var e=d("#main");if(t){if(f.classList.remove("hide"),o.innerWidth<1241)if(m.classList.add("in"),f.classList.add("show"),x){var i=s();e.classList.add("lock"),e.scrollTop=i}else l.classList.add("lock")}else if(f.classList.remove("show"),m.classList.remove("in"),x){i=e.scrollTop;e.classList.remove("lock"),o.scrollTo(0,i)}else l.classList.remove("lock")},fixedHeader:function(t){t>u.clientHeight?u.classList.add("fixed"):u.classList.remove("fixed")},toc:function(){var n=d("#post-toc");if(!n||!n.children.length)return{fixed:c,actived:c};var e=d(".post-header").clientHeight,s=u.clientHeight,a=d("#post-content").querySelectorAll("h1, h2, h3, h4, h5, h6");n.querySelector('a[href="#'+a[0].id+'"]').parentNode.classList.add("active");var t=n.querySelectorAll(".post-toc-child");for(i=0,len=t.length;i<len;i++)t[i].classList.add("post-toc-shrink");var o=n.querySelector('a[href="#'+a[0].id+'"]').nextElementSibling;o&&(o.classList.add("post-toc-expand"),o.classList.remove("post-toc-shrink")),n.classList.remove("post-toc-shrink");function l(t,e){t.classList.remove("active"),e.classList.add("active");var i=e.parentElement.querySelectorAll(".post-toc-child");for(j=0,len1=i.length;j<len1;j++)i[j].classList.remove("post-toc-expand"),i[j].classList.add("post-toc-shrink");var o=e.querySelector(".post-toc-child");o&&(o.classList.remove("post-toc-shrink"),o.classList.add("post-toc-expand"))}return{fixed:function(t){e-s<=t?n.classList.add("fixed"):n.classList.remove("fixed")},actived:function(t){for(i=0,len=a.length;i<len;i++)if(t>r(a[i]).y-s-5){var e=n.querySelector("li.active"),o=n.querySelector('a[href="#'+a[i].id+'"]').parentNode;l(e,o)}t<r(a[0]).y&&l(n.querySelector("li.active"),n.querySelector('a[href="#'+a[0].id+'"]').parentNode)}}}(),hideOnMask:[],modal:function(t){this.$modal=d(t),this.$off=this.$modal.querySelector(".close");var e=this;this.show=function(){m.classList.add("in"),e.$modal.classList.add("ready"),setTimeout(function(){e.$modal.classList.add("in")},0)},this.onHide=c,this.hide=function(){e.onHide(),m.classList.remove("in"),e.$modal.classList.remove("in"),setTimeout(function(){e.$modal.classList.remove("ready")},300)},this.toggle=function(){return e.$modal.classList.contains("in")?e.hide():e.show()},S.hideOnMask.push(this.hide),this.$off&&this.$off.addEventListener(E,this.hide)},share:function(){var e=d("#pageShare"),i=d("#shareFab"),t=new this.modal("#globalShare");d("#menuShare").addEventListener(E,t.toggle),i&&(i.addEventListener(E,function(){e.classList.toggle("in")},!1),n.addEventListener(E,function(t){i.contains(t.target)||e.classList.remove("in")},!1));var o=new this.modal("#wxShare");o.onHide=t.hide,w.call(a(".wxFab"),function(t){t.addEventListener(E,o.toggle)})},search:function(){var t=d("#search-wrap");d("#search").addEventListener(E,function(){t.classList.toggle("in")})},reward:function(){var t=new this.modal("#reward");d("#rewardBtn").addEventListener(E,t.toggle);var e=d("#rewardToggle"),i=d("#rewardCode");e&&e.addEventListener("change",function(){i.src=this.checked?this.dataset.alipay:this.dataset.wechat})},waterfall:function(){o.innerWidth<760||w.call(a(".waterfall"),function(t){var e=t.querySelectorAll(".waterfall-item"),i=[0,0];w.call(e,function(t){var e=i[0]<=i[1]?0:1;t.style.cssText="top:"+i[e]+"px;left:"+(0<e?"50%":0),i[e]+=t.offsetHeight}),t.style.height=Math.max(i[0],i[1])+"px",t.classList.add("in")})},tabBar:function(t){t.parentNode.parentNode.classList.toggle("expand")},page:(t=a(".fade, .fade-scale"),{loaded:function(){w.call(t,function(t){t.classList.add("in")}),0},unload:function(){w.call(t,function(t){t.classList.remove("in")}),0},visible:!1}),lightbox:void w.call(a(".img-lightbox"),function(t){new $(t)}),loadScript:function(t){t.forEach(function(t){var e=n.createElement("script");e.src=t,e.async=!0,h.appendChild(e)})}};function $(t){var a,l,c,r,d;this.$img=t.querySelector("img"),this.$overlay=t.querySelector("overlay"),this.margin=40,this.title=this.$img.title||this.$img.alt||"",this.isZoom=!1,this.calcRect=function(){r=h.clientWidth;var t=(d=h.clientHeight)-2*this.margin,e=a,i=l,o=(this.margin,r<e?r/e:1),n=t<i?t/i:1,s=Math.min(o,n);return{w:e*=s,h:i*=s,t:(d-i)/2-c.top,l:(r-e)/2-c.left+this.$img.offsetLeft}},this.setImgRect=function(t){this.$img.style.cssText="width: "+t.w+"px; max-width: "+t.w+"px; height:"+t.h+"px; top: "+t.t+"px; left: "+t.l+"px"},this.setFrom=function(){this.setImgRect({w:c.width,h:c.height,t:0,l:(t.offsetWidth-c.width)/2})},this.setTo=function(){this.setImgRect(this.calcRect())},this.addTitle=function(){this.title&&(this.$caption=n.createElement("div"),this.$caption.innerHTML=this.title,this.$caption.className="overlay-title",t.appendChild(this.$caption))},this.removeTitle=function(){this.$caption&&t.removeChild(this.$caption)};var e=this;this.zoomIn=function(){a=this.$img.naturalWidth||this.$img.width,l=this.$img.naturalHeight||this.$img.height,c=this.$img.getBoundingClientRect(),t.style.height=c.height+"px",t.classList.add("ready"),this.setFrom(),this.addTitle(),this.$img.classList.add("zoom-in"),setTimeout(function(){t.classList.add("active"),e.setTo(),e.isZoom=!0},0)},this.zoomOut=function(){this.isZoom=!1,t.classList.remove("active"),this.$img.classList.add("zoom-in"),this.setFrom(),setTimeout(function(){e.$img.classList.remove("zoom-in"),e.$img.style.cssText="",e.removeTitle(),t.classList.remove("ready"),t.removeAttribute("style")},300)},t.addEventListener("click",function(t){e.isZoom?e.zoomOut():"IMG"===t.target.tagName&&e.zoomIn()}),n.addEventListener("scroll",function(){e.isZoom&&e.zoomOut()}),o.addEventListener("resize",function(){e.isZoom&&e.zoomOut()})}o.addEventListener("load",function(){L.classList.remove("active"),S.page.loaded(),o.lazyScripts&&o.lazyScripts.length&&S.loadScript(o.lazyScripts)}),o.addEventListener("DOMContentLoaded",function(){S.waterfall();var t=s();S.toc.fixed(t),S.toc.actived(t),S.page.loaded()});var b=!1,T=d('a[href^="mailto"]');T&&T.addEventListener(E,function(){b=!0}),o.addEventListener("beforeunload",function(t){b?b=!1:S.page.unload()}),o.addEventListener("pageshow",function(){S.page.visible||S.page.loaded()}),o.addEventListener("resize",function(){o.BLOG.even=E="ontouchstart"in o?"touchstart":"click",S.toggleMenu(),S.waterfall()}),e.addEventListener(E,function(){y(S.goTop.bind(S,0))},!1),g.addEventListener(E,function(){n.getElementById("vcomments")?y(S.goBottom.bind(S,Math.min(getScrollHeight(n)-getWindowHeight(n),n.getElementById("vcomments").offsetTop))):y(S.goBottom.bind(S,getScrollHeight(n)-getWindowHeight(n)))},!1),v.addEventListener(E,function(t){S.toggleMenu(!0),t.preventDefault()},!1),p.addEventListener(E,function(){f.classList.add("hide")},!1),m.addEventListener(E,function(t){S.toggleMenu(),S.hideOnMask.forEach(function(t){t()}),t.preventDefault()},!1),n.addEventListener("scroll",function(){var t=s();S.toggleGotop(t),S.toggleGoBottom(t),S.fixedHeader(t),S.toc.fixed(t),S.toc.actived(t)},!1),o.BLOG.SHARE&&S.share(),o.BLOG.REWARD&&S.reward(),S.noop=c,S.even=E,S.$=d,S.$$=a;var H=s();S.toggleGotop(H),S.toggleGoBottom(H),Object.keys(S).reduce(function(t,e){return t[e]=S[e],t},o.BLOG),o.Waves?(Waves.init(),Waves.attach(".global-share li",["waves-block"]),Waves.attach(".article-tag-list-link, #page-nav a, #page-nav span",["waves-button"])):console.error("Waves loading failed.")}(window,document);